nSims        <- 100 ## number of simulated data sets
s.all       <- matrix(NA,nrow=nSims*cluster.num*cluster.size,ncol=6)
r<- 1
for (i in 1:nSims)
{
################# cluster effects  ###################################################
cluster    <- rep(1:cluster.num,each=cluster.size)  ## simulate cluster random effects
cluster.re <- rnorm(cluster.num,mean=0,sd=4)    ## map random effects to cluster id
cluster.re <- cluster.re[cluster]
################# simulate Duloxetine contraindication ###############################
d.neg <- rbinom(cluster.num*cluster.size,1,0.35)
################# PROMIS random variables ############################################
mu     <- c(60,60)
sd     <- diag(c(8,8))
rho    <- 0.6
cov    <- sd%*%(rho +diag(1-rho,2))%*%sd
## add in mean zero random cluster effect and also fixed effect for
## Duloxetine contraindication
promis <- mvrnorm(cluster.num*cluster.size,mu,cov) + d.neg*5 + cluster.re
################## generate binary random variables ##################################
cLBP.dur <- fabricatr::correlate(given = rowSums(promis),
rho = .3,
draw_handler = draw_binomial,
prob = .7)
################## create data frame of simulated data ###############################
s.all[r:(r+cluster.num*cluster.size-1),] <- cbind(rep(i,cluster.num*cluster.size), cluster, promis, d.neg, cLBP.dur)
r <- r + cluster.num*cluster.size
}
colnames(s.all) <- c("sim","site","anxiety","depress","dulox.no","cLBP.dur")
head(s.all)
tail(s.all)
head(s.all,n=881)
200/8
200/10
200/12
200/15
200/20
200/40
200/80
200/60
200/100
256/40
install.github("ethan-alt/hdbayes")
library(devtools)
install.github("ethan-alt/hdbayes")
install.packages("devtools")
install.github("ethan-alt/hdbayes")
library(devtools)
install.github("ethan-alt/hdbayes")
library(devtools)
install_github("ethanalt/hdbayes")
install_github("ethan-alt/hdbayes")
help(package=tm)
help(package=tm)
help(package=tm)
help(package=hdbayes)
1/sqrt(10)
s<-1/sqrt(100)
x<-seq(-3,3,by=0.001)
y<-dnorma(x,mean=0,sd=1)
y<-dnorm(x,mean=0,sd=1)
z<-dnorm(x,mean=1,sd=1)
plot(x,y);points(x,z);
z<-dnorm(x,mean=1,sd=s)
z<-dnorm(x,mean=1,sd=s)
y<-dnorm(x,mean=0,sd=s)
plot(x,y);points(x,z);
plot(x,y,type='l');points(x,z,type='l');
z<-dnorm(x,mean=0.5,sd=s)
plot(x,y,type='l');points(x,z,type='l');
(0.95/0.05)/(0.25/0.75)
(0.95/0.05)/(0.75/0.25)
exp(6.33333)/(1+exp(6.33333))
(0.95/0.05)/(0.5/0.5)
820*0.1
820*0.9
820*0.9*0.85
820*0.9*0.925
820*0.9*0.925/4
170*0.925
100/15
100/16
5729.31/(5729.31+34.0864)
103845 *1.15
require(tidyverse);
require(geepack);
require(wgeesel);
install.packages("wgeesel")
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2)
data=contra,
id=id,
family="binomial",
corstr="exchangeable",
scale=NULL,
mismodel= R ~ dose*time)
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data=contra,
id=id,
family="binomial",
corstr="exchangeable",
scale=NULL,
mismodel= R ~ dose*time)
is.na(contra$y)
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$R         <- is.na(contra$y)
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- is.na(contra$y)
#proc gee data=contra2 plots=histogram;
#  class ID ctime(ref='3');
#  missmodel ctime prevY Dose Dose*prevY / type=obslevel;
#  model y(event='1') = time dose time*time dose*time dose*time*time / dist=bin;
#  repeated subject=ID / within=cTime corr=cs;
#run;
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data=contra,
id=id,
family="binomial",
corstr="exchangeable",
scale=NULL,
mismodel= r ~ dose*time)
contra
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data=contra,
id=id,
family="binomial",
corstr="exchangeable",
scale=NULL,
mismodel= r ~ dose*time)
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ dose*time)
r
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ dose)
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "independence",
scale    = NULL,
mismodel = r ~ dose)
contra
contra$r         <- as.integer(is.na(contra$y))
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "independence",
scale    = NULL,
mismodel = r ~ dose)
wgee(y ~ time + dose + dose*time ,
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "independence",
scale    = NULL,
mismodel = r ~ dose)
contra
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
wgee(y ~ time + dose + dose*time ,
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "independence",
scale    = NULL,
mismodel = r ~ dose)
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
#proc gee data=contra2 plots=histogram;
#  class ID ctime(ref='3');
#  missmodel ctime prevY Dose Dose*prevY / type=obslevel;
#  model y(event='1') = time dose time*time dose*time dose*time*time / dist=bin;
#  repeated subject=ID / within=cTime corr=cs;
#run;
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ dose*time)
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ dose*time)
wgee.fit$mis_fit
lag(contra$y,n=1)
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==1] <- 0
contra$prev.y
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==1] <- 0
#proc gee data=contra2 plots=histogram;
#  class ID ctime(ref='3');
#  missmodel ctime prevY Dose Dose*prevY / type=obslevel;
#  model y(event='1') = time dose time*time dose*time dose*time*time / dist=bin;
#  repeated subject=ID / within=cTime corr=cs;
#run;
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ dose*time + prev.y)
wgee.fit
wgee.fit$mis_fit
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
## lag the previous value of y and set to zero for first observation for an ID
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==1] <- 0
## create a factor version of time
contra$cTime <- factor(time)
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
## lag the previous value of y and set to zero for first observation for an ID
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==1] <- 0
## create a factor version of time
contra$cTime <- as.factor(time)
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
## lag the previous value of y and set to zero for first observation for an ID
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==1] <- 0
## create a factor version of time
contra$cTime <- factor(contra$time)
contra
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ cTime + prev.y + dose + dose*prev.y)
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ cTime + prev.y + dose + dose*prev.y)
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ I(time==2) + I(time==3) + I(time==4) + prev.y + dose + dose*prev.y)
wgee.fit$mis_fit
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ I(time==3) + I(time==4)  + prev.y + dose + dose*prev.y)
wgee.fit$mis_fit
summary(wgee.fit)
wgee.fit$mis_fit
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
contra$time      <- contra$time-1
## lag the previous value of y and set to zero for first observation for an ID
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==1] <- 0
## create a factor version of time
contra$cTime <- factor(contra$time)
#proc gee data=contra2 plots=histogram;
#  class ID ctime(ref='3');
#  missmodel ctime prevY Dose Dose*prevY / type=obslevel;
#  model y(event='1') = time time*time dose dose*time dose*time*time / dist=bin;
#  repeated subject=ID / within=cTime corr=cs;
#run;
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ I(time==3) + I(time==4)  + prev.y + dose + dose*prev.y)
summary(wgee.fit)
wgee.fit$mis_fit
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
contra$time      <- contra$time-1
## lag the previous value of y and set to zero for first observation for an ID
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==0] <- 0
## create a factor version of time
contra$cTime <- factor(contra$time)
#proc gee data=contra2 plots=histogram;
#  class ID ctime(ref='3');
#  missmodel ctime prevY Dose Dose*prevY / type=obslevel;
#  model y(event='1') = time time*time dose dose*time dose*time*time / dist=bin;
#  repeated subject=ID / within=cTime corr=cs;
#run;
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ I(time==3) + I(time==4)  + prev.y + dose + dose*prev.y)
summary(wgee.fit)
wgee.fit$mis_fit
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
contra$time      <- contra$time-1
contra
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
contra$time      <- contra$time-1
## lag the previous value of y and set to zero for first observation for an ID
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==0] <- 0
contra
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ I(time==2) + I(time==3)  + prev.y + dose + dose*prev.y)
summary(wgee.fit)
wgee.fit$mis_fit
## Perform wald test for any dose effect
L <- rbind(c(0, 0, 0, 1, 0, 0),
c(0, 0, 0, 0, 1, 0),
c(0, 0, 0, 0, 0, 1))
L
wgee.fit$var
cov    <- wgee.fit$var
chi.sq <- t(L%*%beta)%*%solve(L%*%cov%*%t(L))%*%L%*%beta
wgee.fit$beta
## Perform wald test for any dose effect
L <- rbind(c(0, 0, 0, 1, 0, 0),
c(0, 0, 0, 0, 1, 0),
c(0, 0, 0, 0, 0, 1))
beta   <- c(wgee.fit$beta)
cov    <- wgee.fit$var
chi.sq <- t(L%*%beta)%*%solve(L%*%cov%*%t(L))%*%L%*%beta
chi.sq
print(c(chi.sq,pvalue))
## Perform wald test for any dose effect
L <- rbind(c(0, 0, 0, 1, 0, 0),
c(0, 0, 0, 0, 1, 0),
c(0, 0, 0, 0, 0, 1))
beta    <- c(wgee.fit$beta)
cov     <- wgee.fit$var
chi.sq  <- t(L%*%beta)%*%solve(L%*%cov%*%t(L))%*%L%*%beta
p.value <- 1-dchisq(chi.sq,3)
print(c(chi.sq,p.value))
## Perform wald test for any dose effect
L <- rbind(c(0, 0, 0, 1, 0, 0),
c(0, 0, 0, 0, 1, 0),
c(0, 0, 0, 0, 0, 1))
beta    <- c(wgee.fit$beta)
cov     <- wgee.fit$var
chi.sq  <- t(L%*%beta)%*%solve(L%*%cov%*%t(L))%*%L%*%beta
p.value <- 1-pchisq(chi.sq,3)
print(c(chi.sq,p.value))
require(tidyverse);
require(geepack);
require(wgeesel);
setwd("C:/Users/psioda/Documents/GitHub/bios-courses/BIOS-767/DATA/CONTRA");
## read in the amenorrhea data set
contra           <- tibble(read.table("amenorrhea-data.txt",header=F,na.strings=c(".")))
colnames(contra) <- c("id","dose","time","y");
contra$r         <- 1-as.integer(is.na(contra$y))
contra$time      <- contra$time-1
## lag the previous value of y and set to zero for first observation for an ID
contra$prev.y    <- lag(contra$y,n=1)
contra$prev.y[contra$time==0] <- 0
#proc gee data=contra2 plots=histogram;
#  class ID ctime(ref='3');
#  missmodel ctime prevY Dose Dose*prevY / type=obslevel;
#  model y(event='1') = time time*time dose dose*time dose*time*time / dist=bin;
#  repeated subject=ID / within=cTime corr=cs;
#run;
wgee.fit <-
wgee(y ~ time + I(time^2) + dose + dose*time + dose*I(time^2),
data     = contra,
id       = contra$id,
family   = "binomial",
corstr   = "exchangeable",
scale    = NULL,
mismodel = r ~ I(time==2) + I(time==3)  + prev.y + dose + dose*prev.y)
summary(wgee.fit)
wgee.fit$mis_fit
## Perform wald test for any dose effect
L <- rbind(c(0, 0, 0, 1, 0, 0),
c(0, 0, 0, 0, 1, 0),
c(0, 0, 0, 0, 0, 1))
beta    <- c(wgee.fit$beta)
cov     <- wgee.fit$var
chi.sq  <- t(L%*%beta)%*%solve(L%*%cov%*%t(L))%*%L%*%beta
p.value <- 1-pchisq(chi.sq,3)
## print out p-value and test statistic
print(c(chi.sq,p.value))
